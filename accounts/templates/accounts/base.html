{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}Apartment Management{% endblock %}</title>

    <style>
        /* --- layout + colors --- */
        :root{
            --sidebar-width: 220px;
            --sidebar-bg1: #2d1b47;
            --sidebar-bg2: #1a0f2e;
            --accent: #ffd700;
            --main-grad-a: #667eea;
            --main-grad-b: #764ba2;
            --notice-accent: #c084fc;
            --card-bg: rgba(0,0,0,0.28);
            --muted-white: rgba(255,255,255,0.9);
        }
        *{box-sizing:border-box;margin:0;padding:0}
        html,body{height:100%}
        body{
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
            display:flex;
            min-height:100vh;
            background:linear-gradient(135deg,var(--main-grad-a) 0%,var(--main-grad-b) 100%);
            color:var(--muted-white);
            overflow:hidden;
        }

        /* --- Sidebar --- */
        .sidebar{
            width:var(--sidebar-width);
            background: linear-gradient(180deg,var(--sidebar-bg1) 0%, var(--sidebar-bg2) 100%);
            color:white;
            display:flex;
            flex-direction:column;
            border-right: 1px solid rgba(0,0,0,0.25);
            min-height:100vh;
            padding: 0;
        }
        .sidebar-header{
            padding:22px 18px;
            border-bottom: 1px solid rgba(255,255,255,0.06);
        }
        .sidebar-header h1{
            font-size:16px;
            font-weight:700;
            color:var(--accent);
            letter-spacing:0.6px;
        }
        nav.nav-menu{
            flex:1;
            padding:14px 0;
            display:flex;
            flex-direction:column;
        }
        .nav-link{
            display:block;
            padding:12px 18px;
            color: rgba(255,255,255,0.85);
            text-decoration:none;
            font-size:14px;
            border-left:4px solid transparent;
            transition: all .15s ease;
        }
        .nav-link:hover{
            background: rgba(255,255,255,0.03);
            color: white;
            border-left-color: var(--accent);
        }
        .nav-link.active{
            background: rgba(255,255,255,0.06);
            font-weight:600;
            color:white;
            border-left-color: var(--accent);
        }
        .nav-footer{
            padding: 12px 18px;
            margin-top: auto;
        }

        /* --- Main content area --- */
        .main{
            flex:1;
            overflow:auto;
            padding: 22px 34px;
        }
        .top-row{
            margin-bottom:18px;
            color: rgba(255,255,255,0.72);
            font-size:13px;
        }

        .notice-card{
            background: var(--card-bg);
            border-radius:10px;
            padding:22px;
            box-shadow: 0 6px 14px rgba(0,0,0,0.15);
            max-width: 1100px;
        }
        .notice-title{
            color: var(--notice-accent);
            font-size:24px;
            font-weight:700;
            margin-bottom:14px;
            letter-spacing:1.5px;
        }
        .notice-item{
            background: rgba(255,255,255,0.06);
            padding:14px;
            border-left:4px solid var(--notice-accent);
            border-radius:6px;
            color: white;
        }

        /* small screens */
        @media (max-width:880px){
            .sidebar{ position: fixed; left: 0; top: 0; bottom: 0; z-index: 999; transform: translateX(-100%); transition: transform .22s ease;}
            .sidebar.open{ transform: translateX(0); }
            .main{ padding:12px; margin-left: 0;}
            .menu-toggle{ display:inline-block; margin-bottom:10px; background:transparent; border: 0; color: white; padding:8px 10px; font-weight:600;}
        }

    </style>

    {% block head_extra %}{% endblock %}
</head>
<body>
    <aside class="sidebar" id="appSidebar">
        <div class="sidebar-header">
            <h1>APARTMENT MANAGEMENT</h1>
        </div>

        {% comment %} determine active nav server-side if request is available {% endcomment %}
        {% with url_name=request.resolver_match.url_name %}
        <nav class="nav-menu" aria-label="Main navigation">
            <a class="nav-link {% if url_name == 'apartment_list' or url_name == 'apartment_create' or url_name == 'apartment_update' %}active{% endif %}"
               href="{% url 'apartment_list' %}">Apartments</a>

            <a class="nav-link {% if url_name == 'unit_list' or url_name == 'unit_create' or url_name == 'unit_update' %}active{% endif %}"
               href="{% url 'unit_list' %}">Units</a>

            <a class="nav-link {% if url_name == 'tenants' or url_name == 'tenant_create' or url_name == 'tenant_update' %}active{% endif %}"
               href="{% url 'tenants' %}">Tenants</a>

            <a class="nav-link {% if url_name == 'payment_list' or url_name == 'payment_create' or url_name == 'payment_update' %}active{% endif %}"
               href="{% url 'payment_list' %}">Payments</a>

            <a class="nav-link {% if url_name == 'bill_list' or url_name == 'bill_create' %}active{% endif %}"
               href="{% url 'bill_list' %}">Bills</a>

            <a class="nav-link {% if url_name == 'other_charges_list' or url_name == 'other_charges_create' %}active{% endif %}"
               href="{% url 'other_charges_list' %}">Other Charges</a>

            <div class="nav-footer">
                <a class="nav-link" href="{% url 'logout' %}">Logout</a>
            </div>
        </nav>
        {% endwith %}
    </aside>

    <main class="main">
        <!-- mobile menu toggle -->
        <button class="menu-toggle" id="menuToggle" style="display:none">☰ Menu</button>

        <div class="top-row">
            {% now "g:i A T M j, Y" as now_string %}
            {{ now_string }}
        </div>

        {% block content %}
        <!-- default content — child templates override -->
        <div class="notice-card">
            <div class="notice-title">NOTICE</div>
            <div class="notice-item">No notices to show.</div>
        </div>
        {% endblock %}
    </main>

    <script>
        // --- JS fallback for active nav (if request isn't available in template) ---
        (function(){
            try{
                // If server-side class active exists, no need for fallback.
                if(document.querySelector('.nav-link.active')) return;

                var path = location.pathname.replace(/\/+$/,''); // trim trailing slash
                // map simple URL path fragments to nav links
                var mappings = {
                    '/accounts/apartments': 'Apartments',
                    '/accounts/units': 'Units',
                    '/accounts/tenants': 'Tenants',
                    '/accounts/payments': 'Payments',
                    '/accounts/bills': 'Bills',
                    '/accounts/other-charges': 'Other Charges',
                    '/accounts/other_charges': 'Other Charges',
                };
                var keys = Object.keys(mappings);
                var matched = keys.find(function(k){ return path.indexOf(k) === 0; });
                if(matched){
                    var txt = mappings[matched];
                    var links = document.querySelectorAll('.nav-link');
                    links.forEach(function(a){
                        if(a.textContent.trim() === txt){
                            a.classList.add('active');
                        }
                    });
                }
            }catch(e){
                // silent
            }

            // mobile toggle
            var sidebar = document.getElementById('appSidebar');
            var toggle = document.getElementById('menuToggle');
            function setToggleVisibility(){
                if(window.innerWidth <= 880){
                    toggle.style.display = 'inline-block';
                } else {
                    toggle.style.display = 'none';
                    // ensure sidebar visible on desktop
                    sidebar.classList.remove('open');
                }
            }
            setToggleVisibility();
            window.addEventListener('resize', setToggleVisibility);
            if(toggle){
                toggle.addEventListener('click', function(){ sidebar.classList.toggle('open'); });
            }
        })();
    </script>

    {% block body_extra %}{% endblock %}
</body>
</html>
